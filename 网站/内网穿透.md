---
title: "内网穿透"
date: 2025-02-17
categories: 
  - "内网穿透"
  - "网站与网页"
tags: 
  - "内网穿透"
  - "网站"
---

> 转载链接：[https://mp.weixin.qq.com/s?\_\_biz=Mzg4Njg4MTEwNw==&mid=2247484132&idx=1&sn=250bc5115ca769f89fd2eea6a0035319&chksm=cf93acd8f8e425cea56b927f10a524109ff45615dbdc121b368551ad35b84fb83bb809babdcd#rd](https://mp.weixin.qq.com/s?__biz=Mzg4Njg4MTEwNw==&mid=2247484132&idx=1&sn=250bc5115ca769f89fd2eea6a0035319&chksm=cf93acd8f8e425cea56b927f10a524109ff45615dbdc121b368551ad35b84fb83bb809babdcd#rd)
> 
> 视频链接：[https://www.bilibili.com/video/BV1pwHUepEm4?spm\_id\_from=333.788.videopod.sections&vd\_source=f412fc178503cd4cd82f9c512d4f458d](https://www.bilibili.com/video/BV1pwHUepEm4?spm_id_from=333.788.videopod.sections&vd_source=f412fc178503cd4cd82f9c512d4f458d)

![](images/6719603e57cc77875859c411c7ba70bf)

我们接下来通过两种方式，将本地服务映射到公网中，方便随时随地进行访问。

1. 第一种方式是使用`服务商的内网穿透`，但是往往需要付费才能获取更好的使用体验。

3. 第二种方式是使用`云服务器+Frp服务搭建我们自己的内网穿透服务`,这种方式的缺点是访问速度会受到云服务器带宽的限制，但是搭建个人网站是够用的。

## **一、Coplar 内网穿透服务**

### **1-1、安装内网穿透**

#### **1-1-1、脚本安装**

我们选择使用 `一键自动安装脚本` 安装 coplar 服务。

该脚本适用于Ubuntu16.04/18.04/20.04及以后，Centos7/8及以后版本，树莓派最新官方镜像，及支持systemd的新式Linux操作系统，该脚本会自动判断CPU架构（i386/amd64/mips/arm/arm64等等），自动下载对应cpolar客户端，并自动部署安装

cpolar 安装（国内使用）

```
 curl -L https://www.cpolar.com/static/downloads/install-release-cpolar.sh | sudo bash
```

或 cpolar短链接安装方式：(国外使用）

```
 curl -sL https://git.io/cpolar | sudo bash
```

#### **1-1-2、查看版本号**

有正常显示版本号即为安装成功

```
 cpolar version
```

#### **1-1-3、token认证**

登录cpolar官网后台，点击左侧的验证，查看自己的认证token，之后将token贴在命令行里。

```
 cpolar authtoken xxxxxxx
```

### **1.2、测试内网穿透服务**

`cpolar http [port]` 命令中的\[port\]为本地需要映射到公网种的端口号，这里将8080修改为要映射的服务的端口号即可。

```
 cpolar http 8080
```

执行映射命令，等待片刻，当出现分配的`二级域名`时则说明已经映射成功,此时请求二级域名就可以通过公网访问到我们本地的服务了。

到这里，coplar内网穿透就已经启动成功了，如果需要同时映射多个服务，则需要购买高级版本。

## **二、搭建自己的内网穿透服务**

我们本地服务之所以无法通过公网访问到，归根结底就是因为我们的电脑没有`公网IP`！

既然问题的根源是`公网IP`,那我我们就有解决方案了：

1. 购买公网Ip使用

3. 购买含有公网Ip的云服务器

相比于第一种方案，我相信`爱鼓捣`的大家一定更倾向于更具性价比的方案二！

那么接下来，就使用`一台阿里云服务器` + `Frp内网穿透服务工具`来搭建一套我们自己的内网穿透服务吧！

### **2-1、认识Frp服务**

Frp是一款`简单、高效`的内网穿透工具,支持多种代理类型以及 P2P 通信，为不同场景下的需求提供丰富的解决方案。采用 C/S 模式，将`服务端`部署在具有`公网 IP` 的机器上，`客户端`部署在`内网`或`防火墙内的机器`上，通过访问`暴露在服务器上的端口`，反向代理到处于内网的服务。在此基础上，frp 支持 `TCP, UDP, HTTP, HTTPS` 等多种协议，提供了加密、压缩，身份认证，代理限速，负载均衡等众多能力。此外，还可以通过 xtcp 实现 P2P 通信。功能可谓是非常强大！

Frp的原理简单来说有以下三个点：

- 在拥有`公网IP`的机器上安装服务端（`阿里云服务器`）

- 在`本地机器`上安装客户端（`本地电脑`）

- 会把`云服务器上面的端口`通过反向代理到`本地电脑的端口`上（比如：云服务器`8888端口` -> 本地服务`5244端口`）

这样我们就可以通过`服务器Ip:8888` 访问到 本地`127.0.0.1:5244`端口的服务了！

### **2-2、云服务器安装Frp服务端**

```
 注意：云服务器已经安装Docker服务！
```

#### **2-2-1、拉取FrpS镜像**

通过docker 拉取FrpS（服务端镜像）

```
 docker pull snowdreamtech/frps
```

#### **2-2-2、编辑配置文件**

创建名称为`frps.toml`的配置文件，配置以下内容。

- `bind_port`：frps服务监听端口

- `dashboard_port`: frps后台页面面板端口

- `dashboard_user`: frps后台登录用户名

- `dashboard_pwd`: frps后台登录密码

- `token`: 身份验证(需要配配置在客户端中，不可对外泄露)

```
 [common] # 监听端口 bind_port = 7000 # 面板端口 dashboard_port = 7500 # 登录面板账号设置 dashboard_user = admin dashboard_pwd = admin # 身份验证(需要配配置在客户端中，不可对外泄露) token = F9EA305A645940CB9F9FF7FEFCA8E55A
```

#### **2-2-3、启动容器**

注意配置文件的位置是否正确，文章中的地址是 `/home/frps/frps.toml`,需要替换为自己的配置文件地址。

```
 docker run --restart-always --network host -d -v/home/frps/frps.toml:/etc/frp/frps.toml --name frps snowdreamtech/frps
```

启动成功之后可通过`服务器IP:7500`访问到后台，登录之后可以查看到页面。

如果不能正常访问请在确保服务启动成功的情况下查看`云服务器安全组/防火墙对应端口`是否开放。

### **2-3、本地安装Frp客户端**

```
 注意：本地电脑已经安装Docker服务！
```

#### **2-3-1、拉取FrpC镜像**

通过docker 拉取FrpC（客户端镜像）

```
 docker pull snowdreamtech/frpc
```

#### **2-3-2、编辑配置文件**

创建名称为`frpc.toml`的配置文件，配置以下内容。

- `server_addr`：Frp服务端所在`服务器IP地址`,即公网服务器的ip

- `server_port`: 服务端监听端口，bind\_port，与frps.toml中保存一致

- `token`: 身份验证，与frps.toml中保存一致

- `admin_port`: frpc后台页面面板端口

- `admin_user`: frpc后台登录用户名

- `admin_pwd`: frpcs后台登录密码

```
 # 一个完整的隧道 [隧道名称] type = 隧道类型 local_port = 本地端口 remote_port = 远程端口（服务器端口） # server_addr为FRPS服务器IP地址,即公网服务器的ip server_addr = 47.103.99.116 # server_port为服务端监听端口，bind_port，与frps.toml中保存一致 server_port = 7000 # 身份验证，与frps.toml中保存一致 token = F9EA305A645940CB9F9FF7FEFCA8E55A ​ # 后台端口 admin_port = 7400 admin_user = admin admin_pwd = admin ​ # Alist隧道 [alist] type = tcp local_port = 5244 remote_port = 8888 ​ # memos隧道 [memos] type = tcp local_port = 2530 remote_port = 8889
```

#### **2-3-3、启动容器**

注意配置文件的位置是否正确，文章中的地址是 `/home/frp/frpc.toml`,需要替换为自己的配置文件地址。

```
 docker run --restart=always --network host -d -v /home/frp/frpc.toml:/etc/frp/frpc.toml --name myFrpc snowdreamtech/frpc
```

启动成功之后可通过`服务器IP:7400`访问到后台，登录之后可以查看到页面。

如果不能正常访问请在确保服务启动成功的情况下查看`本地防火墙对应端口`是否开放。

### **2-4、测试内网穿透**

现在Frp客户端和Frp服务端都已经成功安装，后台种均有配置隧道显示。

1. 服务器 `8888端口` -> 本地`5244端口`

3. 服务器 `8889端口` -> 本地`5230端口`

Frp服务端：

Frp客户端：

#### **2-4-1、云服务器IP:8888**

通过公网访问`云服务器IP:8888`

`本地的alist服务`已经可以通过`公网`访问。

#### **2-4-2、云服务器IP:8889**

通过公网访问`云服务器IP:8889`

`本地的memos服务`已经可以通过`公网`访问。
